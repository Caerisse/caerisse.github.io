<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Distribucion de casos de Covid-19 en Argentina </title>
    <style>
        html, body, #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.15/esri/css/main.css">
    <script src="https://js.arcgis.com/4.15/"></script>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/FeatureLayer",
            "esri/widgets/Legend",
            //"esri/popup/content/PieChartMediaInfo"
        ], function(Map, MapView, FeatureLayer, Legend, PieChartMediaInfo) {

            var map = new Map({
                basemap: "gray-vector"
            });

            var view = new MapView({
                container: "viewDiv",
                map: map,
                center: [-65.0,-41.0],
                zoom: 3,
                popup: {
                    dockEnabled: true,
                    dockOptions: {
                        buttonEnabled: false,
                        breakpoint: false
                    }
                }
            });

            var rendererConfirmados = {
                type: "simple",
                symbol: { 
                    type: "simple-marker",
                    color: [0,0,200,0.5],
                    outline: {
                        color: "black",
                        width: 1
                    }
                },
                visualVariables: [
                    {   type: "size",
                        field: "Confirmados",
                        legendOptions: {title: "Casos Confirmados por provincia en Argentina"},
                        stops: [
                            { value: 100, size: 5},
                            { value: 10000, size: 80}
                        ]
                    }
                ],
            }
            
            var popupProvincia = {
                title: "{nam}",
                content: [
                    {   type: "fields",
                        fieldInfos: [
                            {   fieldName: "Confirmados",
                                label: "Casos Confirmados" },
                            {   fieldName: 'Activos',
                                label: "Casos Activos" },,
                            {   fieldName: 'Recuperados',
                                label: "Casos Recuperados" },,
                            {   fieldName: 'Fallecidos',
                                label: "Casos Fallecidos" },
                        ]
                    },
                    {   type: "media",
                        mediaInfos: [
                            {   title: "<b>Distribucion de Casos Confirmados</b>",
                                type: "pie-chart" ,
                                caption: "",
                                value: {
                                    fields: ['Activos','Recuperados','Fallecidos'],
                                    normalizeField: null,
                                }
                            }
                        ]
                    },
                ]
            }

            var labels = {
                symbol: {
                    type: "text",
                    color: "#000000",
                    font: {
                        size: "12px",
                        family: "Noto Sans",
                        style: "italic",
                        weight: "normal"
                        }
                    },
                labelPlacement: "always-horizontal",
                labelExpressionInfo: {
                    expression: "$feature.nam"
                }
            };

            var covidLayer = new FeatureLayer({
                url: "https://services8.arcgis.com/lWclWcVNLPjG6Dvs/arcgis/rest/services/covidarg_points/FeatureServer/0",
                renderer:rendererConfirmados,
                popupTemplate: popupProvincia,
                labelingInfo: [labels],

            });
            map.add(covidLayer, 0);

            var legend = new Legend({
                view: view,
                layerInfos: [{
                    layer: covidLayer,
                    title: 'Leyendas',
                }]
            });

            view.ui.add(legend, "bottom-right");

        });
    </script>
</head>
<body>
    <div id="viewDiv"></div>
</body>
</html>